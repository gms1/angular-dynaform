#!/bin/bash

DN=$(dirname "$0")
BN=$(basename "$0")

PROJ_HOME=$(cd "${DN}/.."; pwd)
. "${DN}/sh/lib.sh"


#---------------------------------------------------------

PKGJSON=(
  package.json
  package-lock.json
  projects/angular-dynaform/core/package.json
  projects/angular-dynaform/basic/package.json
  projects/angular-dynaform/material/package.json
  projects/angular-dynaform/nativescript/package.json
)

#---------------------------------------------------------
if [ $# -ne 1 ]; then
  errormsg "${BN}: usage error: usage: ${BN} version"
  exit 1
fi
VER=$1

pushd "${PROJ_HOME}" &>/dev/null        || die "failed to cwd '${PROJ_HOME}'"

  for file in "${PKGJSON[@]}"; do
    echo updating $file
    perl -i.bak -pe "!\$x && s/(\"version\": *\")[^\"]*(\")/\"version\": \"${VER}\"/ && (\$x=1)" "${file}" || \
      die "failed to update '${file}'"
    rm -f "${file}.bak"
  done


popd &>/dev/null
